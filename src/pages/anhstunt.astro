---
import ANHStuntHilt from "../components/anhstunt/ANHStuntHilt.astro";
import Footer from "../components/LightsaberPageFooter.astro";
import Layout from "../layouts/Layout.astro";
---

<Layout title="ANH Motorised Stunt">
  <main id="anhstunt-background">
    <div id="lightsaber-container">
      <div id="hilt-container">
        <ANHStuntHilt />
      </div>
    </div>
    <Footer />
  </main>
</Layout>

<style>
  main {
    height: 100vh;
    background-color: lightblue;
    transition: background 0.4s;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
    position: relative;
  }

  main:before {
    content: "";
    position: absolute;
    inset: 0;
    background: radial-gradient(
      circle,
      rgba(255, 255, 255, 0) 0%,
      rgba(0, 0, 0, 0.9) 100%
    );
  }

  #lightsaber-container {
    height: 75vh;
    display: flex;
    align-items: end;
  }

  #hilt-container {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    transition: 0.5s;
  }

  @media (min-width: 650px) {
    #lightsaber-container {
      height: 80vw;
      rotate: 90deg;
    }
  }
</style>

<script>
  let powerBtn = document.getElementById("power-btn");
  let blade = document.getElementById("blade");
  let bladeLight = document.getElementById("blade-light");
  let switchElem = document.getElementById("switch");
  let hiltContainer = document.getElementById("hilt-container");
  let anhStuntBackground = document.getElementById("anhstunt-background");

  let isLightsaberOn = false;
  let isZoomIn = true;

  const hum = new Audio("anhstunt-font/hum.wav");
  const switchSound = new Audio("anhstunt-font/switch.mp3");

  hum.volume = 0.7;
  switchSound.volume = 0.7;

  document.addEventListener("click", () => {
    powerBtn?.focus();
  });

  powerBtn?.addEventListener("click", handleLightsaber);

  document.addEventListener("wheel", (event) => {
    if (event.deltaY < 0) {
      zoomIn();
    } else {
      zoomOut();
    }
  });

  function handleLightsaber() {
    if (isLightsaberOn) {
      powerOffSound();
      powerOffBlade();
      isLightsaberOn = false;
    } else {
      powerOnSound();
      powerOnBlade();
      isLightsaberOn = true;
    }
  }

  function zoomIn() {
    if (!isZoomIn) {
      isZoomIn = true;
      hiltContainer!.style.height = "100%";
    }
  }

  function zoomOut() {
    if (isZoomIn) {
      isZoomIn = false;
      hiltContainer!.style.height = "23.73%";
    }
  }

  function powerOffSound() {
    switchSound.play();
    hum.pause();
    hum.currentTime = 0;
  }

  function powerOnSound() {
    hum.play();
    switchSound.play();
    hum.addEventListener("timeupdate", () => {
      const buffer = 0.5;
      if (hum.currentTime > hum.duration - buffer) {
        hum.currentTime = 0;
        if (isLightsaberOn) {
          hum.play();
        }
      }
    });
  }

  function powerOffBlade() {
    blade!.classList.remove("animate");
    bladeLight!.classList.remove("animate");
    switchElem!.style.scale = "1 -1";
    anhStuntBackground!.style.transition = "background 0.7s";
    anhStuntBackground!.style.background = "lightblue";
  }

  function powerOnBlade() {
    blade!.classList.add("animate");
    bladeLight!.classList.add("animate");
    switchElem!.style.scale = "1";
    anhStuntBackground!.style.transition = "background 0.4s";
    anhStuntBackground!.style.background = "#dffff8";
  }
</script>
