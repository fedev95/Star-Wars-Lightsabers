---
import GraflexHilt from "../components/graflex/GraflexHilt.astro";
import Layout from "../layouts/Layout.astro";
---

<Layout title="Luke Skywalker ESB Lightsaber">
  <main id="graflex-background">
    <div id="lightsaber-container">
      <div id="hilt-container">
        <GraflexHilt />
      </div>
    </div>
  </main>
</Layout>

<style>
  main {
    height: 100vh;
    background-color: lightblue;
    transition: background 0.4s;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
    position: relative;
  }

  main:before {
    content: "";
    position: absolute;
    inset: 0;
    background: radial-gradient(
      circle,
      rgba(255, 255, 255, 0) 0%,
      rgba(0, 0, 0, 0.8) 100%
    );
  }

  #lightsaber-container {
    height: 75vh;
    display: flex;
    align-items: end;
  }

  #hilt-container {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    transition: 0.5s;
  }

  @media (min-width: 650px) {
    #lightsaber-container {
      height: 80vw;
      rotate: 90deg;
    }
  }
</style>

<script>
  let graflexBackground = document.getElementById("graflex-background");
  let blade = document.getElementById("blade");
  let powerBtn = document.getElementById("power-btn");
  let hiltContainer = document.getElementById("hilt-container");
  let isLightsaberOn = false;
  let isZoomIn = true;

  document.addEventListener("click", () => {
    powerBtn?.focus();
  });

  document.addEventListener("wheel", (event) => {
    if (event.deltaY < 0) {
      zoomIn();
    } else {
      zoomOut();
    }
  });

  powerBtn?.addEventListener("click", handleLightsaber);

  function handleLightsaber() {
    if (isLightsaberOn) {
      // powerOffSound();
      powerOffBlade();
      isLightsaberOn = false;
    } else {
      // powerOnSound();
      powerOnBlade();
      isLightsaberOn = true;
    }
  }

  function zoomIn() {
    if (!isZoomIn) {
      isZoomIn = true;
      hiltContainer!.style.height = "100%";
      if (isLightsaberOn) {
        // swing2.play();
      }
    }
  }

  function zoomOut() {
    if (isZoomIn) {
      isZoomIn = false;
      hiltContainer!.style.height = "23.08%";
      if (isLightsaberOn) {
        // swing1.play();
      }
    }
  }

  function powerOffBlade() {
    blade!.style.height = "0%";
    blade!.style.visibility = "hidden";
    graflexBackground!.style.background = "lightblue";
  }

  function powerOnBlade() {
    blade!.style.height = "347%";
    blade!.style.visibility = "visible";
    graflexBackground!.style.background = "#a4f3ff";
  }
</script>
